<!doctype html>
<div id="message"></div>


<div id="authBox">
<input id="email" placeholder="Email" />
<input id="password" type="password" placeholder="Password" />
<button id="loginBtn">Login</button>
<button id="logoutBtn" style="display:none">Logout</button>
</div>


<p class="muted">Admin goes to student manager. Teacher goes to attendance dashboard.</p>
</div>


<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"></script>
<script src="/assets/app.js"></script>
<script>
// UI wiring (index)
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const email = document.getElementById('email');
const password = document.getElementById('password');
const message = document.getElementById('message');


loginBtn.addEventListener('click', async () => {
try {
await signIn(email.value, password.value);
message.innerText = 'Signed in. Checking role...';
} catch (e) {
message.innerText = 'Login failed: ' + e.message;
}
});


logoutBtn.addEventListener('click', async () => {
await signOut();
message.innerText = 'Logged out';
});


// On auth state changed, check role and redirect
auth.onAuthStateChanged(async (u) => {
if (!u) {
logoutBtn.style.display = 'none';
loginBtn.style.display = 'inline-block';
return;
}
loginBtn.style.display = 'none';
logoutBtn.style.display = 'inline-block';


const roleDoc = await db.collection('roles').doc(u.uid).get();
if (!roleDoc.exists) {
message.innerText = 'No role assigned. Contact admin.';
return;
}
const role = roleDoc.data().role;
if (role === 'admin') {
window.location.href = '/admin.html';
} else if (role === 'teacher') {
window.location.href = '/teacher.html';
} else {
message.innerText = 'Unknown role: ' + role;
}
});
</script>
</body>
</html>
